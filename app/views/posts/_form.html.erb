<%= form_with model: post, class: "space-y-8" do |f| %>
  <% if post.errors.any? %>
    <div class="glass rounded-2xl p-6 border border-red-500/30">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
          <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <h3 class="text-red-400 font-bold text-lg">오류가 있습니다</h3>
      </div>
      <ul class="space-y-2 text-red-300">
        <% post.errors.full_messages.each do |message| %>
          <li class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full bg-red-400"></span>
            <%= message %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Media Upload -->
  <div data-controller="cloudinary-upload"
       data-cloudinary-upload-cloud-name-value="<%= ENV['CLOUDINARY_CLOUD_NAME'] %>"
       data-cloudinary-upload-upload-preset-value="<%= ENV.fetch('CLOUDINARY_UPLOAD_PRESET', 'mosquito_uploads') %>">

    <label class="block text-lg font-bold text-white mb-3 flex items-center gap-2">
      <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      모기 퇴치 증거
    </label>

    <div class="glass-card border-2 border-dashed border-gray-600 rounded-2xl p-8 text-center hover:border-green-500/50 transition-all duration-300 cursor-pointer group"
         data-action="click->cloudinary-upload#open">

      <!-- Placeholder -->
      <div data-cloudinary-upload-target="placeholder" class="<%= post.media_url.present? ? 'hidden' : '' %>">
        <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center group-hover:scale-110 transition-transform">
          <svg class="h-10 w-10 text-green-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </div>
        <p class="text-gray-300 font-medium mb-1">클릭하여 파일을 업로드하세요</p>
        <p class="text-sm text-gray-500">PNG, JPG, GIF, MP4 (최대 50MB)</p>
      </div>

      <!-- Preview -->
      <div data-cloudinary-upload-target="preview" class="<%= post.media_url.blank? ? 'hidden' : '' %>">
        <% if post.media_url.present? %>
          <% if post.video? %>
            <video src="<%= post.media_url %>" controls class="max-h-64 rounded-xl mx-auto shadow-lg"></video>
          <% else %>
            <img src="<%= post.media_url %>" alt="Preview" class="max-h-64 rounded-xl mx-auto shadow-lg">
          <% end %>
          <div class="flex items-center justify-center gap-2 text-green-400 mt-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span class="font-medium">업로드 완료!</span>
          </div>
        <% end %>
      </div>

      <button type="button"
              data-cloudinary-upload-target="uploadButton"
              data-action="cloudinary-upload#open"
              class="mt-6 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 rounded-xl text-white font-semibold transition-all duration-300 neon-green">
        <%= post.media_url.present? ? '다른 파일 선택' : '파일 선택' %>
      </button>
    </div>

    <!-- Hidden inputs -->
    <%= f.hidden_field :media_url, data: { cloudinary_upload_target: "urlInput" } %>
    <%= f.hidden_field :media_type, data: { cloudinary_upload_target: "typeInput" } %>
    <%= f.hidden_field :thumbnail_url, data: { cloudinary_upload_target: "thumbnailInput" } %>
  </div>

  <!-- Title -->
  <div>
    <label for="post_title" class="block text-lg font-bold text-white mb-3 flex items-center gap-2">
      <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
      </svg>
      제목
    </label>
    <%= f.text_field :title,
        class: "w-full px-5 py-4 glass border border-white/10 rounded-xl text-white placeholder-gray-500 focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 transition-all duration-200 text-lg",
        placeholder: "예: 전기 파리채로 모기 3마리 동시 처치" %>
  </div>

  <!-- Description -->
  <div>
    <label for="post_description" class="block text-lg font-bold text-white mb-3 flex items-center gap-2">
      <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/>
      </svg>
      설명 <span class="text-gray-500 font-normal text-sm">(선택)</span>
    </label>
    <%= f.text_area :description,
        rows: 4,
        class: "w-full px-5 py-4 glass border border-white/10 rounded-xl text-white placeholder-gray-500 focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 resize-none transition-all duration-200",
        placeholder: "어떻게 잡았는지 설명해주세요..." %>
  </div>

  <!-- Submit -->
  <div class="flex gap-4 pt-4">
    <%= f.submit post.persisted? ? "수정하기" : "업로드하기",
        class: "flex-1 py-4 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 rounded-xl text-white font-bold text-lg transition-all duration-300 cursor-pointer neon-green" %>

    <%= link_to "취소", post.persisted? ? post_path(post) : posts_path,
        class: "px-8 py-4 glass hover:bg-white/10 rounded-xl text-white font-medium transition-all duration-200 text-center" %>
  </div>
<% end %>
