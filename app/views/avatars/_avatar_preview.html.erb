<%#
  Avatar Preview Component
  - ì‹¤ì œ ìºë¦­í„° ë² ì´ìŠ¤ ìœ„ì— ì•„ì´í…œì´ ìž¥ì°©ë˜ëŠ” êµ¬ì¡°
  - ë°°ê²½ â†’ ìºë¦­í„° ëª¸ â†’ ì˜ìƒ â†’ ë¨¸ë¦¬ â†’ ëª¨ìž â†’ ì•¡ì„¸ì„œë¦¬ ìˆœì„œë¡œ ë ˆì´ì–´ë§
%>

<!-- Background Layer -->
<div class="absolute inset-0 overflow-hidden">
  <% if avatar.background_item %>
    <!-- ë°°ê²½ ì•„ì´í…œ íš¨ê³¼ -->
    <div class="absolute inset-0 flex items-center justify-center">
      <span class="text-[140px] opacity-15 select-none blur-[2px]"><%= avatar.background_item.display_emoji %></span>
    </div>
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-black/40"></div>
  <% else %>
    <div class="absolute inset-0 bg-gradient-to-br from-slate-800 via-slate-900 to-slate-950"></div>
  <% end %>
</div>

<!-- Character Container - ì´ëª¨ì§€ ê¸°ë°˜ ìºë¦­í„° -->
<div class="absolute inset-0 flex items-center justify-center">
  <div class="relative flex flex-col items-center">

    <!-- ë¨¸ë¦¬ ì•„ì´í…œ (ëª¨ìž/í—¬ë©§ ë“±) -->
    <% if avatar.head_item %>
      <div class="relative z-20 transform hover:scale-110 transition-transform" style="margin-bottom: -20px;">
        <span class="text-5xl drop-shadow-lg"><%= avatar.head_item.display_emoji %></span>
      </div>
    <% end %>

    <!-- ìºë¦­í„° ì–¼êµ´ (ê¸°ë³¸ ì´ëª¨ì§€) -->
    <div class="relative z-10">
      <span class="text-7xl">ðŸ˜Š</span>
    </div>

    <!-- ëª¸í†µ ì•„ì´í…œ (ì˜ìƒ) -->
    <div class="relative z-10 transform hover:scale-105 transition-transform" style="margin-top: -15px;">
      <% if avatar.body_item %>
        <span class="text-6xl drop-shadow-lg"><%= avatar.body_item.display_emoji %></span>
      <% else %>
        <span class="text-6xl opacity-50">ðŸ‘•</span>
      <% end %>
    </div>

    <!-- í•˜ì²´ (ê¸°ë³¸ ë°”ì§€+ì‹ ë°œ) -->
    <div class="flex flex-col items-center" style="margin-top: -10px;">
      <span class="text-4xl">ðŸ‘–</span>
      <div class="flex gap-1" style="margin-top: -8px;">
        <span class="text-2xl">ðŸ‘Ÿ</span>
        <span class="text-2xl">ðŸ‘Ÿ</span>
      </div>
    </div>

    <!-- ì•¡ì„¸ì„œë¦¬ - ì˜¤ë¥¸ì†ì— ë“¤ê³  ìžˆëŠ” ì•„ì´í…œ -->
    <% if avatar.accessory_item %>
      <div class="absolute z-30 transform hover:scale-125 transition-transform animate-bounce-slow" style="right: -50px; top: 50%;">
        <span class="text-4xl drop-shadow-lg"><%= avatar.accessory_item.display_emoji %></span>
      </div>
    <% end %>

    <!-- ìºë¦­í„° ê·¸ë¦¼ìž -->
    <div class="absolute w-24 h-4 bg-black/20 rounded-full blur-md" style="bottom: -10px;"></div>
  </div>
</div>

<!-- í¬ê·€ë„ ê¸€ë¡œìš° íš¨ê³¼ -->
<% best_rarity = [avatar.head_item&.rarity, avatar.body_item&.rarity, avatar.background_item&.rarity, avatar.accessory_item&.rarity].compact.max_by { |r| %w[common rare epic legendary].index(r) || 0 } %>
<% if best_rarity == 'legendary' %>
  <div class="absolute inset-0 pointer-events-none animate-pulse-slow">
    <div class="absolute inset-0 bg-gradient-to-t from-yellow-500/20 via-transparent to-yellow-500/10"></div>
    <div class="absolute inset-x-0 bottom-0 h-1 bg-gradient-to-r from-transparent via-yellow-400 to-transparent"></div>
  </div>
<% elsif best_rarity == 'epic' %>
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute inset-0 bg-gradient-to-t from-purple-500/15 via-transparent to-transparent"></div>
  </div>
<% end %>
